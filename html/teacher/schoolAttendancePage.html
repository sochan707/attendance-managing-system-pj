<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>School Attendance</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://cdn.tailwindcss.com"></script>
    <script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: "#2A4759",
          accent: "#F79B72",
          light: "#EEEEEE",
          muted: "#DDDDDD",
        }
      }
    }
  }
</script>

</head>

<body class="bg-gray-100 text-gray-800 min-h-screen">

<!-- ================= NAVBAR ================= -->
    <nav class="bg-[#2A4759] w-full shadow-2xl">
        <div class="max-w-[1440px] mx-auto flex flex-row justify-between items-center px-4 py-4">
          <!-- left -->
          <div class="flex flex-row gap-3 items-center ">
            <div class="text-[#F79B72] font-bold text-4xl">Tick</div>
          </div>
          
          <!-- right -->
          <div class="flex gap-6 items-center mr-6">
            <a href="./teacherDashboard.html" class="hover:text-accent transition text-light">
              Dashboard
            </a>
              <a class="text-light hover:text-accent" href="./chooseClassPage.html">Classes</a>
              <i class="material-icons text-4xl text-[#F79B72]">account_circle</i>
          </div>

        </div>
    </nav>

<!-- ================= MAIN ================= -->
<main class="max-w-[1440px] mx-auto p-6 grid grid-cols-12 gap-6">

  <!-- ================= LEFT ================= -->
  <section class="col-span-12 lg:col-span-8">

    <!-- HEADER -->
    <h1 class="text-3xl md:text-4xl font-bold mb-2">Class Attendance</h1>
    <p class="text-gray-500 mb-6">
      Time 9:00AM - 10:00AM |
      Date <span id="currentDate"></span>
    </p>

    <!-- ACTION BAR -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
      <input
        id="searchInput"
        type="text"
        placeholder="Search"
        class="border rounded-lg px-4 py-2 w-full md:w-64"
      />

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 w-full md:w-auto">
        <button id="markAll"
          class="bg-[#2A4759] text-[#F79B72] px-4 py-2 rounded-lg hover:bg-[#eeeeee]">
          Mark all present
        </button>

        <button id="resetAll"
          class="bg-[#2A4759] text-[#F79B72] px-4 py-2 rounded-lg hover:bg-[#eeeeee]">
          Reset all
        </button>

        <button id="editBtn"
          class="bg-[#F79B72] text-white px-4 py-2 rounded-lg hover:bg-[#eeeeee] hover:text-[#F79B72]">
          Edit Mode
        </button>
      </div>
    </div>

    <!-- TABLE -->
    <div class="border rounded-xl overflow-hidden bg-white rounded-xl p-6 shadow">
      <div class="max-h-[420px] overflow-y-auto">
        <table class="w-full border-collapse text-sm">
          <thead class="sticky top-0 bg-gray-100 z-10">
            <tr class="font-semibold">
              <th class="p-3 w-12">#</th>
              <th class="p-3 text-left">Student Name</th>
              <th class="p-3 text-center">Student ID</th>
              <th class="p-3 text-center">Status</th>
            </tr>
          </thead>
          <tbody id="studentTable"></tbody>
        </table>
        <p id="noResult" class="hidden text-center p-4 text-gray-500">
          No result found
        </p>
      </div>
    </div>

    <button id="submitBtn"
      class="mt-6 bg-[#F79B72] text-white px-6 py-2 rounded-lg font-semibold">
      Submit
    </button>
  </section>

  <!-- ================= RIGHT ================= -->
  <aside class="col-span-12 lg:col-span-4 bg-slate-700 text-white rounded-xl p-6 shadow">

    <h2 class="text-xl font-bold text-orange-300 mb-4">Attendance History</h2>

    <!-- DATE -->
    <label class="block mb-2 text-sm">Select a date</label>
    <input
      id="datePicker"
      type="date"
      class="w-full px-4 py-2 rounded-lg text-gray-800 mb-6"
    />

    <!-- SUMMARY -->
    <p class="mb-3">Summary for <span id="summaryDate"></span></p>

    <div class="flex gap-4 mb-6">
      <div class="bg-white text-gray-800 rounded-lg p-4 flex-1 text-center">
        <p id="presentPercent" class="text-2xl font-bold text-green-600">0%</p>
        <p class="text-sm">Presents</p>
      </div>

      <div class="bg-orange-400 rounded-lg p-4 flex-1 text-center">
        <p id="absentCount" class="text-2xl font-bold">0</p>
        <p class="text-sm">Absent</p>
      </div>
    </div>

    <!-- DETAIL -->
    <h3 class="font-semibold mb-3">Detail</h3>
    <div id="detailList" class="space-y-3 max-h-64 overflow-y-auto"></div>
  </aside>

</main>

<!-- ================= SCRIPT ================= -->
<script>
/* ---------- DATA ---------- */
const students = [
  { id: "000001", name: "Thoug Socheata" },
  { id: "000002", name: "So Channolly" },
  { id: "000003", name: "Sarin Meassochan" },
  { id: "000004", name: "Kan Menglay" },
  { id: "000005", name: "Kim Tech" },
  { id: "000006", name: "Bon Sak" },
  { id: "000007", name: "Phea Sreynith" }
];

let selectedDate = new Date().toISOString().split("T")[0];
let editMode = true;

/* ---------- ELEMENTS ---------- */
const table = document.getElementById("studentTable");
const currentDateEl = document.getElementById("currentDate");
const summaryDate = document.getElementById("summaryDate");

/* ---------- STORAGE ---------- */
function getData() {
  return JSON.parse(localStorage.getItem(selectedDate)) || {};
}

function saveData(data) {
  localStorage.setItem(selectedDate, JSON.stringify(data));
}

/* ---------- RENDER ---------- */
function renderTable(filter = "") {
  const data = getData();
  table.innerHTML = "";

  const filtered = students.filter(s =>
    s.name.toLowerCase().includes(filter.toLowerCase())
  );

  document.getElementById("noResult").classList.toggle(
    "hidden", filtered.length !== 0
  );

  filtered.forEach((s, i) => {
    const status = data[s.id] || "";
    table.innerHTML += `
      <tr class="border-b">
        <td class="p-3 text-center">${i + 1}</td>
        <td class="p-3">${s.name}</td>
        <td class="p-3 text-center">${s.id}</td>
        <td class="p-3">
          <div class="flex flex-wrap justify-center gap-2">
            ${["Present","Absent","Late","Excused"].map(st => `
              <button
                onclick="setStatus('${s.id}','${st}')"
                class="px-3 py-1 rounded-lg text-xs border
                ${status === st ? statusColor(st) : 'bg-white'}
                ${!editMode ? 'opacity-50 pointer-events-none' : ''}">
                ${st}
              </button>
            `).join("")}
          </div>
        </td>
      </tr>`;
  });
}

/* ---------- HELPERS ---------- */
function statusColor(st) {
  return {
    Present: "bg-green-500 text-white",
    Absent: "bg-red-500 text-white",
    Late: "bg-yellow-400 text-black",
    Excused: "bg-blue-500 text-white"
  }[st];
}

function setStatus(id, status) {
  if (!editMode) return;
  const data = getData();
  data[id] = status;
  saveData(data);
  renderTable(searchInput.value);
  updateSummary();
}

function updateSummary() {
  const data = getData();
  let present = 0, absent = 0;
  detailList.innerHTML = "";

  students.forEach(s => {
    const st = data[s.id];
    if (st === "Present" || st === "Late") present++;
    if (st === "Absent" || st === "Excused") absent++;
    if (st) {
      detailList.innerHTML += `
        <div class="bg-white text-gray-800 rounded-lg px-4 py-2 flex justify-between">
          <span>${s.name}</span>
          <span class="px-2 rounded ${statusColor(st)}">${st}</span>
        </div>`;
    }
  });

  presentPercent.textContent =
    Math.round((present / students.length) * 100) + "%";
  absentCount.textContent = absent;
}

/* ---------- EVENTS ---------- */
markAll.onclick = () => {
  if (!editMode) return;
  const data = {};
  students.forEach(s => data[s.id] = "Present");
  saveData(data);
  renderTable();
  updateSummary();
};

resetAll.onclick = () => {
  if (!editMode) return;
  localStorage.removeItem(selectedDate);
  renderTable(searchInput.value);
  updateSummary();
};

submitBtn.onclick = () => {
  editMode = false;
  alert("Attendance submitted. Edit mode disabled.");
  renderTable(searchInput.value);
};

editBtn.onclick = () => {
  editMode = !editMode;
  editBtn.textContent = editMode ? "Save" : "Edit Mode";
  if (!editMode) alert("Changes saved.");
  renderTable(searchInput.value);
};

datePicker.onchange = e => loadDate(e.target.value);
searchInput.oninput = e => renderTable(e.target.value);

/* ---------- INIT ---------- */
function loadDate(date) {
  selectedDate = date;
  currentDateEl.textContent = date;
  summaryDate.textContent = date;
  datePicker.value = date;
  renderTable();
  updateSummary();
}

loadDate(selectedDate);
</script>

</body>
</html>
